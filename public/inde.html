<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>ChatGPT Mind Map</title>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.css" />
		<style>
#chat {
	display: flex;
	flex-direction: column;
	align-items: center;
	margin-top: 20px;
}
	#user-input {
		width: 300px;
		height: 30px;
		margin-bottom: 10px;
	}#user-input2 {
		width: 300px;
		height: 30px;
		margin-bottom: 10px;
	}#user-input3 {
		width: 40px;
		height: 40px;
		margin-bottom: 10px;
	}

	#send-button {
		width: 80px;
		height: 30px;
	}

		</style>
	</head>
	<body>
		<div id="mindmap" style="width: 100%; height: 500px; border: 2px solid lightgray;"></div>
		<div id="chat">
			<form id="chat-form">
				<input id="user-input" type="text" placeholder="文章を入力してください。" /><br>
				<select id="user-input2">
					<option value="{user}の入力文に対して芸術的感性を以て創造的に返答してください。">Creative</option>
					<option value="{user}の入力文に対して一つずつ段階的かつ論理的に分析し、学術的観点から返答してください。">Academic</option>
					<option value="">Normal</option>
				</select>	
					<br>
				  <select id="response-amount">
					      <option value="1">1 response</option>
					          <option value="2">2 responses</option>
						      <option value="3">3 responses</option>
						      <option value="4">4 response</option>
						      <option value="5">5 response</option>
					          <option value="6">6 responses</option>
						      <option value="7">7 responses</option>
					          <option value="8">8 responses</option>
						      <option value="9">9 responses</option
						      ><option value="10">10 response</option>
						        </select>
				<button id="send-button">Send</button>
			</form>
		</div>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/vis/4.21.0/vis.min.js"></script>
		<script>
			// Create a network
			const nodes = new vis.DataSet();
			const edges = new vis.DataSet();

			const container = document.getElementById('mindmap');
			const data = {
							nodes: nodes,
							edges: edges,
						};
			const options = {
							physics: {
											enabled: true,solver: 'barnesHut',
											barnesHut: {
															gravitationalConstant: -200,
															centralGravity: 0.05,
															springLength: 295,
															springConstant: 0.04,
															damping: 0.09,
															avoidOverlap: 0.8,
														},
											stabilization: {
															enabled: true,
															iterations: 1000,
															updateInterval: 100,
															onlyDynamicEdges: false,
															fit: true,
														},


										},
							nodes: {
											shape: 'box',widthConstraint: {
															maximum: 350,
														},
											font: {
															multi: 'html',
														},
										},edged:{length:300},
										  };
			const network = new vis.Network(container, data, options);

			let nodeId = 1;
			let edgeId = 1;

			const chatForm = document.getElementById('chat-form');
			const userInput = document.getElementById('user-input');
			const userInput2=document.getElementById('user-input2');
const userInput3=document.getElementById('response-amount');
			chatForm.addEventListener('submit', async (e) => {
							e.preventDefault();

							const message = userInput.value;
							userInput.value = '';
							const message2=userInput2.value;
							userInput2.value='';
							const message3=userInput3.value;
							userInput3.value='';
							const userNodeId = nodeId++;
							nodes.add({ id: userNodeId, label: `${message}` });

							try {
											const response = await fetch('/chat', {
															method: 'POST',
															headers: {
																			'Content-Type': 'application/json',
																		},
															body: JSON.stringify({ message,message2,message3 })														});

											const { messages: gptResponses } = await response.json();
											gptResponses.forEach((gptResponse) => {
															const aiNodeId = nodeId++;
															//nodes.add({ id: aiNodeId, label: `AI: ${gptResponse}` });
															nodes.add({
																			id: aiNodeId,
																			label: `${gptResponse}`,
																			color: {
																							background: 'lightgreen',
																							border: 'darkgreen',
																						},
																		});
															edges.add({ id: edgeId++, from: userNodeId, to: aiNodeId });
														});
										} catch (error) {
														console.error(error);
														const errorNodeId = nodeId++;
														nodes.add({ id: errorNodeId, label: 'Error: Failed to fetch AI response.' });
														edges.add({ id: edgeId++, from: userNodeId, to: errorNodeId });
													}
						});









		</script>
	</body>
</html>

